# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
logging.basicConfig(
    level=logging.INFO,
    format='%(asctime)s - %(levelname)s - %(message)s',
    handlers=[
        logging.FileHandler('bot.log', encoding='utf-8'),
        logging.StreamHandler()
    ]
)

# –¢–û–ö–ï–ù –ë–û–¢–ê - –ó–ê–ú–ï–ù–ò–¢–ï –ù–ê –°–í–û–ô!
BOT_TOKEN = "8322357889:AAGmu3y8_2YZ-s_sE__7A_pNSa-q_hwKh2I"

# –°–æ–∑–¥–∞–µ–º –±–æ—Ç–∞
bot = telebot.TeleBot(BOT_TOKEN)

# –§–∞–π–ª –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –∑–∞–ø—É—Å–∫–æ–≤
LOCK_FILE = "bot.lock"


def create_lock_file():
    """–°–æ–∑–¥–∞–µ—Ç —Ñ–∞–π–ª –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏"""
    try:
        with open(LOCK_FILE, 'w') as f:
            f.write(str(os.getpid()))
        return True
    except:
        return False


def remove_lock_file():
    """–£–¥–∞–ª—è–µ—Ç —Ñ–∞–π–ª –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏"""
    try:
        if os.path.exists(LOCK_FILE):
            os.remove(LOCK_FILE)
    except:
        pass


def check_single_instance():
    """–ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ –∑–∞–ø—É—â–µ–Ω —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —ç–∫–∑–µ–º–ø–ª—è—Ä –±–æ—Ç–∞"""
    if os.path.exists(LOCK_FILE):
        logging.error("–ë–æ—Ç —É–∂–µ –∑–∞–ø—É—â–µ–Ω! –ó–∞–≤–µ—Ä—à–∏—Ç–µ –ø—Ä–µ–¥—ã–¥—É—â–∏–π —ç–∫–∑–µ–º–ø–ª—è—Ä.")
        return False
    return create_lock_file()


# –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
def init_db():
    conn = sqlite3.connect('hearts.db')
    cursor = conn.cursor()
    cursor.execute('''
        CREATE TABLE IF NOT EXISTS users (
            user_id INTEGER PRIMARY KEY,
            hearts INTEGER DEFAULT 0,
            username TEXT,
            last_daily_message TEXT
        )
    ''')
    conn.commit()
    conn.close()
    logging.info("–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞")


# –ü–æ–ª—É—á–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–µ—Ä–¥–µ—Ü
def get_hearts(user_id):
    conn = sqlite3.connect('hearts.db')
    cursor = conn.cursor()
    cursor.execute('SELECT hearts FROM users WHERE user_id = ?', (user_id,))
    result = cursor.fetchone()
    if result:
        hearts = result[0]
    else:
        hearts = 0
        cursor.execute('INSERT INTO users (user_id, hearts, username) VALUES (?, ?, ?)',
                       (user_id, hearts, ""))
        conn.commit()
    conn.close()
    return hearts


# –î–æ–±–∞–≤–∏—Ç—å —Å–µ—Ä–¥—Ü–µ
def add_heart(user_id, username):
    conn = sqlite3.connect('hearts.db')
    cursor = conn.cursor()
    hearts = get_hearts(user_id) + 1
    cursor.execute('UPDATE users SET hearts = ?, username = ? WHERE user_id = ?',
                   (hearts, username, user_id))
    conn.commit()
    conn.close()
    return hearts


# –ú–æ—Ç–∏–≤–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ñ—Ä–∞–∑—ã –¥–ª—è –û–ª—å–≥–∏ (—Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫)
MOTIVATIONAL_PHRASES = [
    "–ü—Ä–∏–≤–µ—Ç, —Å–æ–ª–Ω—ã—à–∫–æ –º–æ—ë! ‚òÄÔ∏è –ü—É—Å—Ç—å —Ç–≤–æ–π –¥–µ–Ω—å –±—É–¥–µ—Ç —è—Ä–∫–∏–º –∏ —Å—á–∞—Å—Ç–ª–∏–≤—ã–º!",
    "–î–æ–±—Ä–æ–µ —É—Ç—Ä–æ, –º–æ—è –ø—Ä–µ–∫—Ä–∞—Å–Ω–∞—è –û–ª–µ—á–∫–∞! üí´ –¢—ã —Å–ø—Ä–∞–≤–∏—à—å—Å—è —Å–æ –≤—Å–µ–º–∏ –∑–∞–¥–∞—á–∞–º–∏ —Å–µ–≥–æ–¥–Ω—è!",
    "–ü—Ä–æ—Å–Ω–∏—Å—å, –º–æ—è —Ä–∞–¥–æ—Å—Ç—å! üå∑ –°–µ–≥–æ–¥–Ω—è —Ç–µ–±—è –∂–¥–µ—Ç –º–Ω–æ–≥–æ –ø—Ä–µ–∫—Ä–∞—Å–Ω–æ–≥–æ!",
    "–ü—Ä–∏–≤–µ—Ç, –∫–æ—Ç—ë–Ω–æ–∫ –º–æ–π! üê± –£–¥–∞—á–Ω–æ–≥–æ –¥–Ω—è –∏ –ø–æ–º–Ω–∏ - —è –≤—Å–µ–≥–¥–∞ –æ —Ç–µ–±–µ –¥—É–º–∞—é!",
    "–£—Ç—Ä–æ –¥–æ–±—Ä–æ–µ, –º–æ—è —É–º–Ω–∏—á–∫–∞! üåü –ü—É—Å—Ç—å —Å–µ–≥–æ–¥–Ω—è –≤—Å–µ –ø–æ–ª—É—á–∞–µ—Ç—Å—è –ª–µ–≥–∫–æ!",
    "–ü—Ä–æ—Å—ã–ø–∞–π—Å—è, –º–æ—è —Ö–æ—Ä–æ—à–∞—è! üíñ –≠—Ç–æ—Ç –¥–µ–Ω—å —Å–æ–∑–¥–∞–Ω –¥–ª—è —Ç–µ–±—è!",
    "–ü—Ä–∏–≤–µ—Ç, –∑–∞–π–∫–∞ –º–æ—è! üê∞ –£–ª—ã–±–Ω–∏—Å—å, –∏ –≤–µ—Å—å –º–∏—Ä —É–ª—ã–±–Ω–µ—Ç—Å—è —Ç–µ–±–µ –≤ –æ—Ç–≤–µ—Ç!",
    "–î–æ–±—Ä–æ–µ —É—Ç—Ä–æ, –û–ª–µ—á–∫–∞! üå∏ –¢—ã —Å–∞–º–∞—è –∫—Ä–∞—Å–∏–≤–∞—è –∏ —É–º–Ω–∞—è!",
    "–ü—Ä–æ—Å–Ω–∏—Å—å, —Å–æ–ª–Ω—Ü–µ! üåû –°–µ–≥–æ–¥–Ω—è —Ç–≤–æ–π –¥–µ–Ω—å —Å–∏—è—Ç—å!",
    "–ü—Ä–∏–≤–µ—Ç, –º–æ—è –ª–∞–ø–æ—á–∫–∞! üíï –¢—ã –¥–µ–ª–∞–µ—à—å –º–∏—Ä –ª—É—á—à–µ!",
    "–î–æ–±—Ä–æ–µ —É—Ç—Ä–æ, —Ä–∞–¥–æ—Å—Ç—å –º–æ—è! ‚ú® –ü—É—Å—Ç—å —Å–µ–≥–æ–¥–Ω—è –∏—Å–ø–æ–ª–Ω—è—Ç—Å—è —Ç–≤–æ–∏ –∂–µ–ª–∞–Ω–∏—è!",
    "–ü—Ä–æ—Å—ã–ø–∞–π—Å—è, —É–º–Ω–∏—Ü–∞! üåº –¢—ã –º–æ–∂–µ—à—å –≤—Å—ë, —á—Ç–æ –∑–∞—Ö–æ—á–µ—à—å!",
    "–ü—Ä–∏–≤–µ—Ç, —Ä—ã–±–∫–∞ –º–æ—è! üê† –ü–ª—ã–≤–∏ –ø–æ –∂–∏–∑–Ω–∏ —É–≤–µ—Ä–µ–Ω–Ω–æ!",
    "–£—Ç—Ä–æ –¥–æ–±—Ä–æ–µ, –º–æ—ë —Å—á–∞—Å—Ç—å–µ! üíù –°–µ–≥–æ–¥–Ω—è –±—É–¥–µ—Ç –º–Ω–æ–≥–æ –ø—Ä–∏—è—Ç–Ω—ã—Ö –º–æ–º–µ–Ω—Ç–æ–≤!",
    "–ü—Ä–æ—Å–Ω–∏—Å—å, –ø—Ä–µ–ª–µ—Å—Ç—å! üåπ –¢—ã —É–Ω–∏–∫–∞–ª—å–Ω–∞ –∏ –Ω–µ–ø–æ–≤—Ç–æ—Ä–∏–º–∞!",
    "–ü—Ä–∏–≤–µ—Ç, –ø—Ç–∏—á–∫–∞ –º–æ—è! üê¶ –õ–µ—Ç–∏ –∫ —Å–≤–æ–∏–º –º–µ—á—Ç–∞–º!",
    "–î–æ–±—Ä–æ–µ —É—Ç—Ä–æ, –∑–≤—ë–∑–¥–æ—á–∫–∞! ‚≠êÔ∏è –°–≤–µ—Ç–∏ —è—Ä–∫–æ —Å–µ–≥–æ–¥–Ω—è!",
    "–ü—Ä–æ—Å—ã–ø–∞–π—Å—è, –±—É—Å–∏–Ω–∫–∞! üìø –¢—ã –¥—Ä–∞–≥–æ—Ü–µ–Ω–Ω–æ—Å—Ç—å!",
    "–ü—Ä–∏–≤–µ—Ç, –º—É–∑–∞ –º–æ—è! üé® –í–¥–æ—Ö–Ω–æ–≤–ª—è–π –≤—Å–µ—Ö –≤–æ–∫—Ä—É–≥!",
    "–î–æ–±—Ä–æ–µ —É—Ç—Ä–æ, —Ç–∏–≥—Ä–∏—Ü–∞! üêØ –ë—É–¥—å —Å–º–µ–ª–æ–π –∏ —Å–∏–ª—å–Ω–æ–π!",
    "–ü—Ä–æ—Å–Ω–∏—Å—å, —Ñ–µ—è –º–æ—è! üßö‚Äç‚ôÄÔ∏è –¢–≤–æ—Ä–∏ –≤–æ–ª—à–µ–±—Å—Ç–≤–æ —Å–µ–≥–æ–¥–Ω—è!",
    "–ü—Ä–∏–≤–µ—Ç, –ø—Ä–∏–Ω—Ü–µ—Å—Å–∞! üëë –ù–æ—Å–∏ –∫–æ—Ä–æ–Ω—É —Å –≥–æ—Ä–¥–æ—Å—Ç—å—é!",
    "–î–æ–±—Ä–æ–µ —É—Ç—Ä–æ, —á–µ–º–ø–∏–æ–Ω–∫–∞! üèÜ –¢—ã –ø–æ–±–µ–¥–∏—à—å –≤—Å–µ —Ç—Ä—É–¥–Ω–æ—Å—Ç–∏!",
    "–ü—Ä–æ—Å—ã–ø–∞–π—Å—è, —Ä–∞–¥—É–≥–∞! üåà –ù–µ—Å–∏ —Ü–≤–µ—Ç –≤ —ç—Ç–æ—Ç –º–∏—Ä!",
    "–ü—Ä–∏–≤–µ—Ç, –ø—á–µ–ª–∫–∞ –º–æ—è! üêù –¢—Ä—É–¥–∏—Å—å —É—Å–µ—Ä–¥–Ω–æ, –Ω–æ –æ—Ç–¥—ã—Ö–∞–π!",
    "–î–æ–±—Ä–æ–µ —É—Ç—Ä–æ, –±–∞–±–æ—á–∫–∞! ü¶ã –ü—Ä–µ–≤—Ä–∞—â–∞–π—Å—è –≤ –ª—É—á—à—É—é —Å–µ–±—è!",
    "–ü—Ä–æ—Å–Ω–∏—Å—å, –∫–æ–Ω—Ñ–µ—Ç–∫–∞! üç¨ –ë—É–¥—å —Å–ª–∞–¥–∫–æ–π –∏ –ª—é–±–∏–º–æ–π!",
    "–ü—Ä–∏–≤–µ—Ç, –≥–µ—Ä–æ–∏–Ω—è! ü¶∏‚Äç‚ôÄÔ∏è –°–ø–∞—Å–∞–π –º–∏—Ä —Å–≤–æ–µ–π –¥–æ–±—Ä–æ—Ç–æ–π!",
    "–î–æ–±—Ä–æ–µ —É—Ç—Ä–æ, –≤–æ–ª—à–µ–±–Ω–∏—Ü–∞! üîÆ –¢–≤–æ–∏ –º–µ—á—Ç—ã —Å–±—ã–≤–∞—é—Ç—Å—è!",
    "–ü—Ä–æ—Å—ã–ø–∞–π—Å—è, —Å–æ–∫—Ä–æ–≤–∏—â–µ! üíé –¢—ã –±–µ—Å—Ü–µ–Ω–Ω–∞!",
    "–ü—Ä–∏–≤–µ—Ç, —Ä–∞–¥–æ—Å—Ç—å –º–æ—è! üòä –¢–≤–æ–µ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤–∏–µ –¥–µ–ª–∞–µ—Ç –º–∏—Ä –ª—É—á—à–µ!",
    "–î–æ–±—Ä–æ–µ —É—Ç—Ä–æ, –º–æ—è —Ö–æ—Ä–æ—à–∞—è! üåû –ü—É—Å—Ç—å –¥–µ–Ω—å –ø—Ä–∏–Ω–µ—Å–µ—Ç —Ç–æ–ª—å–∫–æ –ø—Ä–∏—è—Ç–Ω—ã–µ —Å—é—Ä–ø—Ä–∏–∑—ã!",
    "–ü—Ä–æ—Å–Ω–∏—Å—å, –∫—Ä–∞—Å–∞–≤–∏—Ü–∞! üå∏ –¢–≤–æ—è —É–ª—ã–±–∫–∞ - —Å–∞–º–æ–µ —Ü–µ–Ω–Ω–æ–µ —Å–æ–∫—Ä–æ–≤–∏—â–µ!",
    "–ü—Ä–∏–≤–µ—Ç, –º–æ–π –∞–Ω–≥–µ–ª–æ—á–µ–∫! üëº –¢—ã –ø—Ä–∏–Ω–æ—Å–∏—à—å –≤ –º–æ—é –∂–∏–∑–Ω—å —Å—Ç–æ–ª—å–∫–æ —Å–≤–µ—Ç–∞!",
    "–£—Ç—Ä–æ –¥–æ–±—Ä–æ–µ, –º–æ—è —É–º–Ω–∏—á–∫–∞! üíñ –°–µ–≥–æ–¥–Ω—è –≤—Å–µ –±—É–¥–µ—Ç —Ç–∞–∫, –∫–∞–∫ —Ç—ã –∑–∞—Ö–æ—á–µ—à—å!",
    "–ü—Ä–æ—Å—ã–ø–∞–π—Å—è, —Å–æ–ª–Ω—ã—à–∫–æ! üåÖ –ù–æ–≤—ã–π –¥–µ–Ω—å - –Ω–æ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –¥–ª—è —Å—á–∞—Å—Ç—å—è!",
    "–ü—Ä–∏–≤–µ—Ç, –º–æ—è –Ω–µ–Ω–∞–≥–ª—è–¥–Ω–∞—è! üíï –¢—ã —Å–∞–º–æ–µ –ª—É—á—à–µ–µ, —á—Ç–æ —Å–ª—É—á–∏–ª–æ—Å—å –≤ –º–æ–µ–π –∂–∏–∑–Ω–∏!",
    "–î–æ–±—Ä–æ–µ —É—Ç—Ä–æ, –º–æ—è –ø—Ä–µ–∫—Ä–∞—Å–Ω–∞—è! ‚ú® –¢—ã –∑–∞—Å–ª—É–∂–∏–≤–∞–µ—à—å –≤—Å–µ–≥–æ —Å–∞–º–æ–≥–æ –ª—É—á—à–µ–≥–æ!",
    "–ü—Ä–æ—Å–Ω–∏—Å—å, –º–æ—è –ª—é–±–∏–º–∞—è! üåπ –ö–∞–∂–¥—ã–π –¥–µ–Ω—å —Å —Ç–æ–±–æ–π - —ç—Ç–æ –ø–æ–¥–∞—Ä–æ–∫!",
    "–ü—Ä–∏–≤–µ—Ç, —Å–µ—Ä–¥–µ—á–∫–æ –º–æ–µ! üíò –¢—ã –Ω–∞–ø–æ–ª–Ω—è–µ—à—å –º–æ—é –∂–∏–∑–Ω—å —Å–º—ã—Å–ª–æ–º!",
    "–î–æ–±—Ä–æ–µ —É—Ç—Ä–æ, –º–æ—è –∫–æ—Ä–æ–ª–µ–≤–∞! üëë –ü—Ä–∞–≤–∏ —Å–≤–æ–π –¥–µ–Ω—å —Å —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å—é!",
    "–ü—Ä–æ—Å—ã–ø–∞–π—Å—è, –º–æ—è –º–µ—á—Ç–∞! üå† –¢—ã –º–æ–∂–µ—à—å –¥–æ—Å—Ç–∏—á—å –≤—Å–µ–≥–æ, –æ —á–µ–º –º–µ—á—Ç–∞–µ—à—å!",
    "–ü—Ä–∏–≤–µ—Ç, –º–æ—ë —Å—á–∞—Å—Ç—å–µ! üòç –¢–≤–æ–µ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤–∏–µ –¥–µ–ª–∞–µ—Ç –ª—é–±–æ–π –¥–µ–Ω—å –ø—Ä–∞–∑–¥–Ω–∏–∫–æ–º!",
    "–î–æ–±—Ä–æ–µ —É—Ç—Ä–æ, –º–æ—è —Ä–∞–¥–æ—Å—Ç—å! üí´ –ü—É—Å—Ç—å —Å–µ–≥–æ–¥–Ω—è—à–Ω–∏–π –¥–µ–Ω—å –±—É–¥–µ—Ç –≤–æ–ª—à–µ–±–Ω—ã–º!",
    "–ü—Ä–æ—Å–Ω–∏—Å—å, –º–æ—è —Ö–æ—Ä–æ—à–∞—è! üåº –¢—ã —Å–∏–ª—å–Ω–µ–µ, —á–µ–º –¥—É–º–∞–µ—à—å, –∏ –∫—Ä–∞—Å–∏–≤–µ–µ, —á–µ–º –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—à—å!",
    "–ü—Ä–∏–≤–µ—Ç, –º–æ—è –±—É—Å–∏–Ω–∫–∞! üíé –¢—ã —É–Ω–∏–∫–∞–ª—å–Ω–∞ –∏ –Ω–µ–ø–æ–≤—Ç–æ—Ä–∏–º–∞!",
    "–î–æ–±—Ä–æ–µ —É—Ç—Ä–æ, –º–æ—è –∑–≤—ë–∑–¥–æ—á–∫–∞! ‚≠êÔ∏è –°–≤–µ—Ç–∏ —Ç–∞–∫, —á—Ç–æ–±—ã –≤—Å–µ –≤–∏–¥–µ–ª–∏ —Ç–≤–æ—é –∫—Ä–∞—Å–æ—Ç—É!",
    "–ü—Ä–æ—Å—ã–ø–∞–π—Å—è, –º–æ—è –º—É–∑–∞! üé® –í–¥–æ—Ö–Ω–æ–≤–ª—è–π –≤—Å–µ—Ö –≤–æ–∫—Ä—É–≥ —Å–µ–≥–æ–¥–Ω—è —Å–≤–æ–µ–π —ç–Ω–µ—Ä–≥–∏–µ–π!",
    "–ü—Ä–∏–≤–µ—Ç, –º–æ—è —Ç–∏–≥—Ä–∏—Ü–∞! üêØ –ë—É–¥—å —Å–º–µ–ª–æ–π –∏ —Ä–µ—à–∏—Ç–µ–ª—å–Ω–æ–π —Å–µ–≥–æ–¥–Ω—è!",
    "–î–æ–±—Ä–æ–µ —É—Ç—Ä–æ, –º–æ—è —Ñ–µ—è! üßö‚Äç‚ôÄÔ∏è –¢–≤–æ—Ä–∏ –≤–æ–ª—à–µ–±—Å—Ç–≤–æ —Å–≤–æ–∏–º–∏ –¥–æ–±—Ä—ã–º–∏ –¥–µ–ª–∞–º–∏!",
]

# –°–æ–æ–±—â–µ–Ω–∏—è –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –≤—Ä–µ–º–µ–Ω
TIME_MESSAGES = {
    14: "–Ø —Ç–µ–±—è –ª—é–±–ª—é ‚ù§Ô∏è",
    18: "–¢—ã —Å–∞–º–∞—è —è—Ä–∫–∞—è ‚ú®",
    20: "–ü—Ä–∏—è—Ç–Ω—ã—Ö —Ç–µ–±–µ —Å–Ω–æ–≤ üåôüí´",
    3: "–ó–Ω–∞—é —á—Ç–æ —Ç—ã —Å–ø–∏—à—å, –ø—Ä–æ—Å—Ç–æ –ª—é–±–ª—é —Ç–µ–±—è üò¥üíï"
}

# –¢—Ä–∏–≥–≥–µ—Ä—ã –∏ –æ—Ç–≤–µ—Ç—ã
TRIGGERS = {
    "–º–Ω–µ –ø–ª–æ—Ö–æ": "–ë–æ–∂–µ –º–æ–π, –º–∞–ª—ã—à–∫–∞ —á—Ç–æ —Å–ª—É—á–∏–ª–æ—Å—å üò¢ –Ø –≤—Å–µ–≥–¥–∞ —Ä—è–¥–æ–º –∏ –ø–æ–¥–¥–µ—Ä–∂—É —Ç–µ–±—è, –Ω–µ –≤–∞–∂–Ω–æ –≤ —Å–µ—Ç–∏ —è –∏–ª–∏ –Ω–µ—Ç ‚ù§Ô∏è –ü–æ–∑–≤–æ–Ω–∏ –º–Ω–µ –∏ —Ä–∞—Å—Å–∫–∞–∂–∏ –º–Ω–µ –≤—Å–µ —á—Ç–æ –Ω–∞ –¥—É—à–µ, —è –≤—Å–µ–≥–¥–∞ –≥–æ—Ç–æ–≤ –≤—ã—Å–ª—É—à–∞—Ç—å –∏ –ø–æ–º–æ—á—å —Ç–µ–±–µ üíï –¢—ã –Ω–µ –æ–¥–Ω–∞, —è —Å —Ç–æ–±–æ–π –≤—Å–µ–≥–¥–∞, –¥–∞–∂–µ –Ω–∞ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–∏ ü§ó",

    "–º–Ω–µ —Å–∫—É—á–Ω–æ": "–û—Ö, —Å–∫—É—á–Ω–æ? –î–∞–≤–∞–π —Ä–∞–∑–≤–µ–µ–º —Å–∫—É–∫—É –≤–º–µ—Å—Ç–µ! üòÑ –í–æ—Ç —Ç–µ–±–µ —Å—Å—ã–ª–∫–∞ –Ω–∞ —Å–º–µ—à–Ω—ã–µ –∞–Ω–µ–∫–¥–æ—Ç—ã: https://www.anekdot.ru\n–ù–∞–¥–µ—é—Å—å, –æ–Ω–∏ –ø–æ–¥–Ω–∏–º—É—Ç —Ç–µ–±–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ! üí´ –ê –µ—â–µ –º–æ–∂–µ—à—å –ø–æ–∑–≤–æ–Ω–∏—Ç—å –º–Ω–µ - –≤–º–µ—Å—Ç–µ –≤—Å–µ–≥–¥–∞ –≤–µ—Å–µ–ª–µ–µ! üéâ",

    "—è —Ç–µ–±—è –ª—é–±–ª—é": "–Ø —Ç–µ–±—è –ª—é–±–ª—é –∫–∞–∫ 30000 —Ä–∞–∑ –¥–æ –ª—É–Ω—ã –∏ –æ–±—Ä–∞—Ç–Ω–æ! üåôüöÄüí´ –ú–æ—è –ª—é–±–æ–≤—å –∫ —Ç–µ–±–µ –±–µ–∑–≥—Ä–∞–Ω–∏—á–Ω–∞ –∫–∞–∫ –≤—Å–µ–ª–µ–Ω–Ω–∞—è –∏ —è—Ä—á–µ —á–µ–º –º–∏–ª–ª–∏–æ–Ω —Å–æ–ª–Ω—Ü! ‚òÄÔ∏èüíñ –¢—ã - —Å–∞–º–æ–µ –¥–æ—Ä–æ–≥–æ–µ, —á—Ç–æ –µ—Å—Ç—å –≤ –º–æ–µ–π –∂–∏–∑–Ω–∏, –∏ —è –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ –±–ª–∞–≥–æ–¥–∞—Ä–µ–Ω –∑–∞ –∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É —Å —Ç–æ–±–æ–π! üíï",

    "—Å–∫—É—á–Ω–æ": "–ï—Å–ª–∏ —Å–∫—É—á–Ω–æ, –¥–∞–≤–∞–π —è –ø–æ–¥–Ω–∏–º—É —Ç–µ–±–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ! üòä –í–æ—Ç —Å–º–µ—à–Ω—ã–µ –∞–Ω–µ–∫–¥–æ—Ç—ã: https://www.anekdot.ru\n–ò –ø–æ–º–Ω–∏ - —Ç—ã –≤—Å–µ–≥–¥–∞ –º–æ–∂–µ—à—å –ø–æ–∑–≤–æ–Ω–∏—Ç—å –º–Ω–µ! üìûüíï",

    "–≥—Ä—É—Å—Ç–Ω–æ": "–ú–∏–ª—ã–π –º–æ–π —á–µ–ª–æ–≤–µ—á–µ–∫, –Ω–µ –≥—Ä—É—Å—Ç–∏ ü•∫ –Ø –∑–¥–µ—Å—å –¥–ª—è —Ç–µ–±—è! –•–æ—á–µ—à—å, —Ä–∞—Å—Å–∫–∞–∂—É —Ç–µ–±–µ –∫–∞–∫ —Å–∏–ª—å–Ω–æ —Ç—ã –º–µ–Ω—è–µ—à—å –º–∏—Ä –∫ –ª—É—á—à–µ–º—É –ø—Ä–æ—Å—Ç–æ —Å–≤–æ–∏–º —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ–º? üí´ –¢—ã - –ª—É—á–∏–∫ —Å–≤–µ—Ç–∞ –≤ —ç—Ç–æ–º –º–∏—Ä–µ! üåû",

    "—É—Å—Ç–∞–ª–∞": "–ú–æ—è —Ö–æ—Ä–æ—à–∞—è, —Ç—ã —Ç–∞–∫ –º–Ω–æ–≥–æ —Å—Ç–∞—Ä–∞–µ—à—å—Å—è! ü•∫ –ü–æ–º–Ω–∏, —á—Ç–æ –æ—Ç–¥—ã—Ö - —ç—Ç–æ —Ç–æ–∂–µ –≤–∞–∂–Ω–∞—è —Ä–∞–±–æ—Ç–∞ üíï –ü—Ä–∏–ª—è–≥, –æ—Ç–¥–æ—Ö–Ω–∏, –∞ —è –±—É–¥—É –¥—É–º–∞—Ç—å –æ —Ç–µ–±–µ –∏ –ø–æ—Å—ã–ª–∞—Ç—å —Ç–µ–±–µ —Å–∏–ª—ã –∏ —ç–Ω–µ—Ä–≥–∏—é! ‚ú® –¢—ã –∑–∞—Å–ª—É–∂–∏–≤–∞–µ—à—å —Å–∞–º–æ–≥–æ –ª—É—á—à–µ–≥–æ –æ—Ç–¥—ã—Ö–∞! üåô"
}


# –û—Å–Ω–æ–≤–Ω–∞—è –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞ (–≤—Å–µ–≥–¥–∞ –≤–∏–¥–Ω–∞)
def create_main_keyboard():
    keyboard = telebot.types.ReplyKeyboardMarkup(resize_keyboard=True)
    button1 = telebot.types.KeyboardButton("–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–µ—Ä–¥–µ—á–∫–∏ üíï")
    button2 = telebot.types.KeyboardButton("–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è ‚ÑπÔ∏è")
    keyboard.add(button1, button2)
    return keyboard


# –ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞ –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –º–æ—Ç–∏–≤–∞—Ü–∏–∏
def create_motivation_keyboard():
    keyboard = telebot.types.ReplyKeyboardMarkup(resize_keyboard=True)
    button = telebot.types.KeyboardButton("–ú–æ—Ç–∏–≤–∞—Ü–∏—è –ø—Ä–∏–Ω—è—Ç–∞! üíñ")
    keyboard.add(button)
    return keyboard


# –ö–æ–º–∞–Ω–¥–∞ /start
@bot.message_handler(commands=['start'])
def send_welcome(message):
    user_name = message.from_user.first_name
    user_id = message.from_user.id

    get_hearts(user_id)

    if user_name and "–æ–ª—å–≥–∞" in user_name.lower():
        bot.send_message(
            message.chat.id,
            f"–ü—Ä–∏–≤–µ—Ç, –º–æ—è –ª—é–±–∏–º–∞—è –û–ª–µ—á–∫–∞! üíñ\n"
            f"–Ø –±—É–¥—É —Å —Ç–æ–±–æ–π –≤—Å–µ–≥–¥–∞ - –¥–Ω–µ–º –∏ –Ω–æ—á—å—é! üåûüåô\n"
            f"–ú–æ—Ç–∏–≤–∞—Ü–∏—è –≤ 10:00, –∞ –≤ —Ç–µ—á–µ–Ω–∏–µ –¥–Ω—è - –ø—Ä–∏—è—Ç–Ω—ã–µ —Å—é—Ä–ø—Ä–∏–∑—ã! ‚ú®\n"
            f"–ë–æ—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ –ê–í–¢–û–ù–û–ú–ù–û–ú —Ä–µ–∂–∏–º–µ 24/7! üöÄ",
            reply_markup=create_main_keyboard()
        )
    else:
        bot.send_message(
            message.chat.id,
            "–ü—Ä–∏–≤–µ—Ç! –≠—Ç–æ—Ç –±–æ—Ç —Å–æ–∑–¥–∞–Ω —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ –¥–ª—è –û–ª—å–≥–∏ üíï",
            reply_markup=create_main_keyboard()
        )


# –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–Ω–æ–ø–∫–∏ "–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è"
@bot.message_handler(func=lambda message: message.text == "–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è ‚ÑπÔ∏è")
def show_info(message):
    info_text = """
ü§ñ **–ò–ù–§–û–†–ú–ê–¶–ò–Ø –û –ë–û–¢–ï**

üíù **–ê–≤—Ç–æ–Ω–æ–º–Ω—ã–π —Ä–µ–∂–∏–º 24/7:**
‚Ä¢ –ë–æ—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ—Å—Ç–æ—è–Ω–Ω–æ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
‚Ä¢ –ù–µ —Ç—Ä–µ–±—É–µ—Ç –≤–∫–ª—é—á–µ–Ω–Ω–æ–≥–æ –∫–æ–º–ø—å—é—Ç–µ—Ä–∞
‚Ä¢ –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

üïê **–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π:**
‚Ä¢ 10:00 - –£—Ç—Ä–µ–Ω–Ω—è—è –º–æ—Ç–∏–≤–∞—Ü–∏—è üí´
‚Ä¢ 14:00 - –ü—Ä–∏—è—Ç–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ ‚ù§Ô∏è  
‚Ä¢ 18:00 - –í–µ—á–µ—Ä–Ω–∏–π –∫–æ–º–ø–ª–∏–º–µ–Ω—Ç ‚ú®
‚Ä¢ 20:00 - –ü–æ–∂–µ–ª–∞–Ω–∏–µ –Ω–∞ –Ω–æ—á—å üåô
‚Ä¢ 03:00 - –ù–æ—á–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ üò¥

üéÅ **–°–∏—Å—Ç–µ–º–∞ –ø–æ–¥–∞—Ä–∫–æ–≤:**
‚Ä¢ –ö–∞–∂–¥—ã–µ 50 —Å–µ—Ä–¥–µ—Ü - —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π –ø–æ–¥–∞—Ä–æ–∫!
‚Ä¢ 50‚ù§Ô∏è, 100‚ù§Ô∏è, 150‚ù§Ô∏è, 200‚ù§Ô∏è –∏ —Ç–∞–∫ –¥–æ 1000‚ù§Ô∏è

üí¨ **–ë–æ—Ç —Ä–µ–∞–≥–∏—Ä—É–µ—Ç –Ω–∞ —Å–ª–æ–≤–∞:**
‚Ä¢ "–º–Ω–µ –ø–ª–æ—Ö–æ" - –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –∏ –∑–∞–±–æ—Ç–∞ ü§ó
‚Ä¢ "–º–Ω–µ —Å–∫—É—á–Ω–æ" –∏–ª–∏ "—Å–∫—É—á–Ω–æ" - —Ä–∞–∑–≤–ª–µ—á–µ–Ω–∏—è üòÑ  
‚Ä¢ "—è —Ç–µ–±—è –ª—é–±–ª—é" - —Ä–æ–º–∞–Ω—Ç–∏—á–Ω—ã–π –æ—Ç–≤–µ—Ç üíï
‚Ä¢ "–≥—Ä—É—Å—Ç–Ω–æ" - —É—Ç–µ—à–µ–Ω–∏–µ –∏ –º–æ—Ç–∏–≤–∞—Ü–∏—è üåü
‚Ä¢ "—É—Å—Ç–∞–ª–∞" - –∑–∞–±–æ—Ç–∞ –æ–± –æ—Ç–¥—ã—Ö–µ üí§

üíï **–¶–µ–ª—å –±–æ—Ç–∞:** 
–ù–∞–ø–æ–º–∏–Ω–∞—Ç—å –û–ª–µ—á–∫–µ –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –æ —Ç–æ–º, –∫–∞–∫–∞—è –æ–Ω–∞ –æ—Å–æ–±–µ–Ω–Ω–∞—è, –ª—é–±–∏–º–∞—è –∏ –≤–∞–∂–Ω–∞—è! ‚ú®
    """
    bot.send_message(message.chat.id, info_text, reply_markup=create_main_keyboard())


# –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–Ω–æ–ø–∫–∏ "–ú–æ—Ç–∏–≤–∞—Ü–∏—è –ø—Ä–∏–Ω—è—Ç–∞!"
@bot.message_handler(func=lambda message: message.text == "–ú–æ—Ç–∏–≤–∞—Ü–∏—è –ø—Ä–∏–Ω—è—Ç–∞! üíñ")
def accept_motivation(message):
    user_id = message.from_user.id
    username = message.from_user.first_name

    hearts = add_heart(user_id, username)

    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π
    milestone_message = ""
    if hearts % 50 == 0 and hearts > 0:
        milestone_message = f"\n\nüéâ –ü–û–ó–î–†–ê–í–õ–Ø–Æ! –¢—ã –Ω–∞–±—Ä–∞–ª–∞ {hearts} —Å–µ—Ä–¥–µ—Ü! üéâ\n–û–±—Ä–∞—Ç–∏—Å—å –∫ –º—É–∂—É –∑–∞ –ø–æ–¥–∞—Ä–∫–æ–º! üíù"

    # –°–ª—É—á–∞–π–Ω—ã–π –∫–æ–º–ø–ª–∏–º–µ–Ω—Ç –ø–æ—Å–ª–µ –ø—Ä–∏–Ω—è—Ç–∏—è –º–æ—Ç–∏–≤–∞—Ü–∏–∏
    compliments = [
        "–¢—ã —Å–µ–≥–æ–¥–Ω—è –ø—Ä–æ—Å—Ç–æ –Ω–µ–≤–µ—Ä–æ—è—Ç–Ω–∞! üåü",
        "–ö–∞–∫ –∂–µ –º–Ω–µ –ø–æ–≤–µ–∑–ª–æ —Å —Ç–æ–±–æ–π! üíï",
        "–¢–≤–æ—è —É–ª—ã–±–∫–∞ –¥–µ–ª–∞–µ—Ç –º–æ–π –¥–µ–Ω—å –ª—É—á—à–µ! üòä",
        "–¢—ã —Å–ø—Ä–∞–≤–∏—à—å—Å—è —Å –ª—é–±—ã–º–∏ –∑–∞–¥–∞—á–∞–º–∏! üí™",
        "–¢—ã –≤–¥–æ—Ö–Ω–æ–≤–ª—è–µ—à—å –º–µ–Ω—è –∫–∞–∂–¥—ã–π –¥–µ–Ω—å! ‚ú®",
        "–° —Ç–æ–±–æ–π –≤–æ–∑–º–æ–∂–Ω–æ –≤—Å—ë! üöÄ",
        "–¢—ã - –º–æ—è —Å–∞–º–∞—è –±–æ–ª—å—à–∞—è –≥–æ—Ä–¥–æ—Å—Ç—å! üåü",
        "–ö–∞–∫ –∂–µ —è —Ç–µ–±—è –ª—é–±–ª—é! ‚ù§Ô∏è"
    ]

    compliment = random.choice(compliments)

    bot.send_message(
        message.chat.id,
        f"–û—Ç–ª–∏—á–Ω–æ! –ú–æ—Ç–∏–≤–∞—Ü–∏—è –ø—Ä–∏–Ω—è—Ç–∞! üíñ\n"
        f"–¢–≤–æ–π —Å—á—ë—Ç: {hearts} —Å–µ—Ä–¥–µ—Ü\n"
        f"{compliment}{milestone_message}",
        reply_markup=create_main_keyboard()
    )


# –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–Ω–æ–ø–∫–∏ "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–µ—Ä–¥–µ—á–∫–∏"
@bot.message_handler(func=lambda message: message.text == "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–µ—Ä–¥–µ—á–∫–∏ üíï")
def check_hearts(message):
    user_id = message.from_user.id
    hearts = get_hearts(user_id)

    next_gift = 50 - (hearts % 50)
    if next_gift == 50:
        next_gift = 0

    if hearts >= 1000:
        status = "üèÜ –¢—ã –¥–æ—Å—Ç–∏–≥–ª–∞ –º–∞–∫—Å–∏–º—É–º–∞! –¢—ã —á–µ–º–ø–∏–æ–Ω–∫–∞!"
    elif hearts >= 500:
        status = "üåü –ù–µ–≤–µ—Ä–æ—è—Ç–Ω–æ! –¢—ã –Ω–∞ –ø–æ–ª–ø—É—Ç–∏ –∫ –≤–µ—Ä—à–∏–Ω–µ!"
    elif hearts >= 100:
        status = "üí´ –û—Ç–ª–∏—á–Ω–æ –ø—Ä–æ–¥–≤–∏–≥–∞–µ—à—å—Å—è!"
    else:
        status = "üíï –ü—Ä–æ–¥–æ–ª–∂–∞–π –≤ —Ç–æ–º –∂–µ –¥—É—Ö–µ!"

    # –°–ª—É—á–∞–π–Ω–æ–µ –º–æ—Ç–∏–≤–∏—Ä—É—é—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
    motivators = [
        "–ö–∞–∂–¥–æ–µ —Å–µ—Ä–¥–µ—á–∫–æ - —ç—Ç–æ —Ç–≤–æ—è –º–∞–ª–µ–Ω—å–∫–∞—è –ø–æ–±–µ–¥–∞! üéØ",
        "–¢—ã —Å–æ–±–∏—Ä–∞–µ—à—å –Ω–µ –ø—Ä–æ—Å—Ç–æ —Å–µ—Ä–¥–µ—á–∫–∏, –∞ —á–∞—Å—Ç–∏—á–∫–∏ –Ω–∞—à–µ–π –ª—é–±–≤–∏! üíû",
        "–° –∫–∞–∂–¥—ã–º –¥–Ω–µ–º —Ç—ã —Å—Ç–∞–Ω–æ–≤–∏—à—å—Å—è –≤—Å–µ —Å–∏–ª—å–Ω–µ–µ! üí™",
        "–¢–≤–æ—è —Ü–µ–ª–µ—É—Å—Ç—Ä–µ–º–ª–µ–Ω–Ω–æ—Å—Ç—å –≤–æ—Å—Ö–∏—â–∞–µ—Ç! üåü",
        "–Ø —Ç–∞–∫ –≥–æ—Ä–∂—É—Å—å —Ç–æ–±–æ–π! ü•∞",
        "–¢—ã - –ø—Ä–∏–º–µ—Ä –¥–ª—è –ø–æ–¥—Ä–∞–∂–∞–Ω–∏—è! üëë",
        "–¢–≤–æ—è –Ω–∞—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å –≤–¥–æ—Ö–Ω–æ–≤–ª—è–µ—Ç! ‚ú®"
    ]

    motivator = random.choice(motivators)

    bot.send_message(
        message.chat.id,
        f"üíï **–¢–≤–æ–π —Ç–µ–∫—É—â–∏–π —Å—á—ë—Ç:** {hearts} —Å–µ—Ä–¥–µ—Ü!\n"
        f"üéÅ **–î–æ —Å–ª–µ–¥—É—é—â–µ–≥–æ –ø–æ–¥–∞—Ä–∫–∞:** {next_gift} —Å–µ—Ä–¥–µ—Ü\n"
        f"‚ú® **–°—Ç–∞—Ç—É—Å:** {status}\n"
        f"üí´ **{motivator}**",
        reply_markup=create_main_keyboard()
    )


# –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç—Ä–∏–≥–≥–µ—Ä–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
@bot.message_handler(func=lambda message: True)
def handle_all_messages(message):
    user_id = message.from_user.id
    text = message.text.lower()

    # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç—Ä–∏–≥–≥–µ—Ä—ã
    for trigger, response in TRIGGERS.items():
        if trigger in text:
            bot.send_message(message.chat.id, response, reply_markup=create_main_keyboard())
            return

    # –ï—Å–ª–∏ –Ω–µ —Ç—Ä–∏–≥–≥–µ—Ä, –Ω–æ –∏–º—è –û–ª—å–≥–∞ - –æ—Ç–≤–µ—á–∞–µ–º –º–∏–ª–æ
    user_name = message.from_user.first_name
    if user_name and "–æ–ª—å–≥–∞" in user_name.lower():
        cute_responses = [
            "–Ø —Ç–µ–±—è —Å–ª—ã—à—É, —Å–æ–ª–Ω—ã—à–∫–æ! üí´",
            "–í—Å–µ–≥–¥–∞ —Ä–∞–¥ —Ç–≤–æ–∏–º —Å–æ–æ–±—â–µ–Ω–∏—è–º! üíï",
            "–¢—ã - —Å–∞–º–æ–µ –ª—É—á—à–µ–µ, —á—Ç–æ –µ—Å—Ç—å –≤ –º–æ–µ–π –∂–∏–∑–Ω–∏! üåü",
            "–ö–∞–∫ –∂–µ —è –ª—é–±–ª—é –Ω–∞—à–∏ —Ä–∞–∑–≥–æ–≤–æ—Ä—ã! üíñ",
            "–¢–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å–¥–µ–ª–∞–ª–æ –º–æ–π –¥–µ–Ω—å –ª—É—á—à–µ! ‚ú®",
            "–û–±–æ–∂–∞—é –ø–æ–ª—É—á–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç —Ç–µ–±—è! üòä",
            "–¢—ã –Ω–∞–ø–æ–ª–Ω—è–µ—à—å –º–æ—é –∂–∏–∑–Ω—å —Å–º—ã—Å–ª–æ–º! üí´"
        ]
        response = random.choice(cute_responses)
        bot.send_message(message.chat.id, response, reply_markup=create_main_keyboard())
    else:
        bot.send_message(
            message.chat.id,
            "–ò—Å–ø–æ–ª—å–∑—É–π –∫–Ω–æ–ø–∫–∏ –Ω–∏–∂–µ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –±–æ—Ç–æ–º! üíï",
            reply_markup=create_main_keyboard()
        )


# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é
def send_scheduled_messages():
    last_sent_hours = {}  # –î–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –ø–æ —á–∞—Å–∞–º

    while True:
        try:
            now = datetime.now()
            current_hour = now.hour
            current_minute = now.minute

            # –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤—Å–µ –≤—Ä–µ–º–µ–Ω–∞ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ (–≤ –Ω–∞—á–∞–ª–µ —á–∞—Å–∞)
            if current_minute == 0:
                if current_hour in TIME_MESSAGES and last_sent_hours.get(current_hour) != now.day:
                    logging.info(f"–û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –¥–ª—è –≤—Ä–µ–º–µ–Ω–∏ {current_hour}:00")

                    conn = sqlite3.connect('hearts.db')
                    cursor = conn.cursor()
                    cursor.execute('SELECT user_id FROM users')
                    users = cursor.fetchall()
                    conn.close()

                    message_text = TIME_MESSAGES[current_hour]

                    for user_tuple in users:
                        user_id = user_tuple[0]
                        try:
                            bot.send_message(user_id, message_text, reply_markup=create_main_keyboard())
                            logging.info(f"–°–æ–æ–±—â–µ–Ω–∏–µ –≤ {current_hour}:00 –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é {user_id}")
                        except Exception as e:
                            logging.error(f"–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é {user_id}: {e}")

                    last_sent_hours[current_hour] = now.day

            # –ï–∂–µ–¥–Ω–µ–≤–Ω–∞—è –º–æ—Ç–∏–≤–∞—Ü–∏—è –≤ 10:00
            if current_hour == 10 and current_minute == 0 and last_sent_hours.get('motivation') != now.day:
                logging.info("–û—Ç–ø—Ä–∞–≤–∫–∞ –µ–∂–µ–¥–Ω–µ–≤–Ω—ã—Ö –º–æ—Ç–∏–≤–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π...")

                conn = sqlite3.connect('hearts.db')
                cursor = conn.cursor()
                cursor.execute('SELECT user_id FROM users')
                users = cursor.fetchall()
                conn.close()

                for user_tuple in users:
                    user_id = user_tuple[0]
                    try:
                        phrase = random.choice(MOTIVATIONAL_PHRASES)
                        bot.send_message(user_id, phrase, reply_markup=create_motivation_keyboard())
                        logging.info(f"–ú–æ—Ç–∏–≤–∞—Ü–∏—è –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é {user_id}")
                    except Exception as e:
                        logging.error(f"–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –º–æ—Ç–∏–≤–∞—Ü–∏–∏ {user_id}: {e}")

                last_sent_hours['motivation'] = now.day
                time.sleep(60)  # –ñ–¥–µ–º –º–∏–Ω—É—Ç—É —á—Ç–æ–±—ã –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –ø–æ–≤—Ç–æ—Ä–Ω–æ

            time.sleep(30)  # –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥

        except Exception as e:
            logging.error(f"–û—à–∏–±–∫–∞ –≤ scheduled_messages: {e}")
            time.sleep(60)


# –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞ —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ—à–∏–±–æ–∫
def run_bot():
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –∑–∞–ø—É—â–µ–Ω —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —ç–∫–∑–µ–º–ø–ª—è—Ä
    if not check_single_instance():
        logging.error("–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞: —É–∂–µ –∑–∞–ø—É—â–µ–Ω –¥—Ä—É–≥–æ–π —ç–∫–∑–µ–º–ø–ª—è—Ä!")
        print("‚ùå –û–®–ò–ë–ö–ê: –ë–æ—Ç —É–∂–µ –∑–∞–ø—É—â–µ–Ω! –ó–∞–≤–µ—Ä—à–∏—Ç–µ –ø—Ä–µ–¥—ã–¥—É—â—É—é –≤–µ—Ä—Å–∏—é.")
        sys.exit(1)

    try:
        logging.info("–ó–∞–ø—É—Å–∫ –±–æ—Ç–∞ –≤ –∞–≤—Ç–æ–Ω–æ–º–Ω–æ–º —Ä–µ–∂–∏–º–µ...")
        init_db()

        # –ó–∞–ø—É—Å–∫–∞–µ–º –ø–æ—Ç–æ–∫ –¥–ª—è —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π
        schedule_thread = threading.Thread(target=send_scheduled_messages)
        schedule_thread.daemon = True
        schedule_thread.start()

        logging.info("ü§ñ –ë–æ—Ç –∑–∞–ø—É—â–µ–Ω –≤ –ê–í–¢–û–ù–û–ú–ù–û–ú —Ä–µ–∂–∏–º–µ 24/7!")
        print("=" * 60)
        print("ü§ñ –ë–û–¢ –ó–ê–ü–£–©–ï–ù –í –ê–í–¢–û–ù–û–ú–ù–û–ú –†–ï–ñ–ò–ú–ï!")
        print("üí´ –¢–µ–ø–µ—Ä—å –æ–Ω –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –ø–æ—Å—Ç–æ—è–Ω–Ω–æ")
        print("üïê –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ: 10:00, 14:00, 18:00, 20:00, 03:00")
        print("‚èπÔ∏è –î–ª—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –Ω–∞–∂–º–∏—Ç–µ Ctrl+C")
        print("=" * 60)

        # –û—Å–Ω–æ–≤–Ω–æ–π —Ü–∏–∫–ª –±–æ—Ç–∞ —Å –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–æ–º –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö
        while True:
            try:
                bot.polling(none_stop=True, interval=1, timeout=60)
            except Exception as e:
                logging.error(f"–û—à–∏–±–∫–∞ polling: {e}")
                logging.info("–ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ polling —á–µ—Ä–µ–∑ 10 —Å–µ–∫—É–Ω–¥...")
                time.sleep(10)

    except Exception as e:
        logging.error(f"–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –±–æ—Ç–∞: {e}")
    finally:
        # –í—Å–µ–≥–¥–∞ —É–¥–∞–ª—è–µ–º —Ñ–∞–π–ª –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏
        remove_lock_file()
        logging.info("–ë–æ—Ç –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω")


if __name__ == "__main__":
    # –û–±—Ä–∞–±–æ—Ç–∫–∞ Ctrl+C –¥–ª—è graceful shutdown
    try:
        run_bot()
    except KeyboardInterrupt:
        print("\nüõë –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –±–æ—Ç–∞...")
        remove_lock_file()
        print("üëã –ë–æ—Ç –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω!")
    except Exception as e:
        print(f"‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞: {e}")
        remove_lock_file()
